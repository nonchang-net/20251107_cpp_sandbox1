# 20251110_1140 - MML（Music Macro Language）実装

## 変更内容の概要

- ユーザー定義リテラル`_mml`でMML（Music Macro Language）を実装した
- Sequencerクラスを拡張して、NoteDataの`is_rest`（休符）と`wave_type`（音色）フィールドに対応させた
- test_impl_3.hにMMLリテラルを使用したテストケース（EnterキーとMキー）を追加した

## 変更理由

音楽データを簡潔に記述できるようにするため、MMLを実装した。MMLは"t120 o4 l4 cdefgab"のようなテキストで音楽を表現でき、オシレーター変更機能（@コマンド）も含めることで、シーケンス内で音色を切り替えられるようにした。これにより、複雑な音楽データも直感的に記述できる。

## 変更箇所

### game_manager/sound_synthesizer.h

1. **Sequencerクラスのメソッド修正**:
   - `addNote()`: wave_typeパラメータを追加し、NoteDataの新しいコンストラクタを使用
   - `addRest()`: is_restフラグを使用するように変更
   - `playCurrentNote()`: is_restフラグで休符を判定し、wave_typeをオシレーターに設定するように変更
   - `setSequence()`: MMLから生成されたNoteDataリストを設定する新しいメソッドを追加（ムーブ版とコピー版）

### game/test_impl_3.h

1. **キーバインディングの追加と変更**:
   - **Enterキー**: MMLリテラル`"t120 o4 l4 @0 cdefedec"_mml`でカエルの歌を再生（サイン波）
   - **Mキー（新規）**: MMLリテラル`"t140 o4 l8 @1 cdefgab>c r4 @2 <bagfedc"_mml`でオシレーター変更デモを再生（矩形波→休符→ノコギリ波）

2. **ヘルプテキストの更新**:
   - 画面に表示される操作説明を更新して、MMLのキー（Enter/M）を追加

## テスト方法

1. ビルドして実行: `cmake --build build && ./build/main`
2. **Enterキー**: カエルの歌（ドレミファミレド）がサイン波で再生される
3. **Mキー**: 上昇音階（矩形波）→休符→下降音階（ノコギリ波）が再生される
4. **0キー**: シーケンス停止

## MML記法

実装したMML記法：
- **c, d, e, f, g, a, b**: ドレミファソラシ
- **+, #**: シャープ（半音上げる）
- **-**: フラット（半音下げる）
- **数字**: 音符の長さ（1=全音符、2=2分音符、4=4分音符、8=8分音符など）
- **o数字**: オクターブ指定（o4など）
- **r**: 休符
- **l数字**: デフォルトの音符長を設定
- **t数字**: テンポ（BPM）を設定
- **@数字**: 音色を設定（0=サイン波、1=矩形波、2=ノコギリ波）
- **.**: 付点音符（音符の長さを1.5倍に）
- **<**: オクターブを1つ下げる
- **>**: オクターブを1つ上げる

## 使用例

```cpp
// カエルの歌
auto notes = "t120 o4 l4 @0 cdefedec"_mml;
sequencer_->setSequence(std::move(notes));
sequencer_->play();

// オシレーター変更デモ
auto notes = "t140 o4 l8 @1 cdefgab>c r4 @2 <bagfedc"_mml;
sequencer_->setSequence(std::move(notes));
sequencer_->play();
```
